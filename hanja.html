<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hanja Dictionary</title>
    <style>
        body { font-family: Arial, sans-serif; }
        section { margin-bottom: 30px; border-bottom: 2px solid #ccc; padding-bottom: 20px; }
        h2 { color: #4CAF50; }
        .phrase { margin-bottom: 20px; }
        .phrase-header { font-weight: bold; font-size: 1.2em; margin-bottom: 10px; }
        .character-boxes { display: flex; gap: 10px; margin-bottom: 10px; }
        .character-box { border: 1px solid #ccc; padding: 10px; text-align: center; width: 100px; }
        .character-box .hanja { font-size: 2em; font-weight: bold; }
        .character-box .korean { font-size: 1em; color: #555; }
        .character-box .sound { font-size: 0.9em; color: #777; }
        .phrase-meaning { font-style: italic; color: #333; }
    </style>
</head>
<body>
    <h1>천자문 한자 목록</h1>
    <div id="hanja-sections"></div>

    <script>
        const SHEET_ID = '11u6-30QjGz08BPbj5mC_abQr64lpzHuH59AoWgP3VLU' ; 
        const URL = 'https://docs.google.com/spreadsheets/d/11u6-30QjGz08BPbj5mC_abQr64lpzHuH59AoWgP3VLU/gviz/tq?tqx=out:json';

        fetch(URL)
            .then(response => response.text())
            .then(data => {
                const json = JSON.parse(data.substring(47, data.length - 2));
                const rows = json.table.rows.map(row => row.c.map(cell => cell ? cell.v : ''));

                displayData(rows);
            })
            .catch(error => console.error('Error loading data:', error));

        function displayData(data) {
            const sections = {
                1: { start: 1, end: 18 },
                2: { start: 19, end: 51 },
                3: { start: 52, end: 81 },
                4: { start: 82, end: 124 },
                5: { start: 125, end: 125 }
            };

            const container = document.getElementById('hanja-sections');
            let currentSection = 1;

            data.forEach(row => {
                const [sectionHanja, sectionKorean, sectionMeaning, phraseNumber, phraseHanja, phraseKorean, phraseMeaning, characterHanja, characterKorean, characterSound] = row;

                if (sectionHanja && sectionKorean && sectionMeaning) {
                    const sectionDiv = document.createElement('section');
                    sectionDiv.id = `section-${currentSection}`;
                    sectionDiv.innerHTML = `<h2>${sectionHanja} - ${sectionKorean}</h2><p>${sectionMeaning}</p>`;
                    container.appendChild(sectionDiv);
                    currentSection++;
                }
            });

         // Loop through each section and display phrases
Object.entries(sections).forEach(([section, range]) => {
    const sectionDiv = document.getElementById(`section-${section}`);
    if (!sectionDiv) return;

    // Filter phrases belonging to the current section
    const sectionPhrases = data.filter(row => {
        const phraseNumber = Number(row[3]);
        return phraseNumber >= range.start && phraseNumber <= range.end;
    });

    // Loop through each phrase within the section
    sectionPhrases.forEach(row => {
        const [ , , , phraseNumber, phraseHanja, phraseKorean, phraseMeaning] = row;

        // Create the container for each phrase
        const phraseDiv = document.createElement('div');
        phraseDiv.classList.add('phrase');

        // Phrase header: number, full phrase in Hanja, and Korean reading
        phraseDiv.innerHTML = `
            <div class="phrase-header">${phraseNumber}. ${phraseHanja} (${phraseKorean})</div>
        `;

        // First 4 character boxes
        createCharacterSet(phraseDiv, data, phraseNumber, 0, 4);

        // Second 4 character boxes
        createCharacterSet(phraseDiv, data, phraseNumber, 4, 8);

        // Append the phrase to the section
        sectionDiv.appendChild(phraseDiv);
    });
});

// Function to create a character set with 4 boxes and the corresponding meaning
function createCharacterSet(container, data, phraseNumber, start, end) {
    // Create a container for character boxes
    const characterBoxes = document.createElement('div');
    characterBoxes.classList.add('character-boxes');
    addCharacterBoxes(characterBoxes, data, phraseNumber, start, end);
    container.appendChild(characterBoxes);

    // Find and append the 4-character meaning from column G
    const meaningDiv = document.createElement('div');
    meaningDiv.classList.add('phrase-meaning');
    const meaningRow = data.find(r => Number(r[3]) === phraseNumber && r[6]);
    meaningDiv.textContent = meaningRow ? meaningRow[6] : '';
    container.appendChild(meaningDiv);
}

// Function to add individual character boxes (4 characters in a row)
function addCharacterBoxes(container, data, phraseNumber, start, end) {
    for (let i = start; i < end; i++) {
        // Find the row with character data for the current phrase
        const characterRow = data.find(r => Number(r[3]) === phraseNumber && r[7 + i - start]);
        if (characterRow) {
            const characterBox = document.createElement('div');
            characterBox.classList.add('character-box');
            characterBox.innerHTML = `
                <div class="hanja">${characterRow[7]}</div>
                <div class="korean">${characterRow[8]}</div>
                <div class="sound">${characterRow[9]}</div>
            `;
            container.appendChild(characterBox);
        }
    }
}
    </script>
</body>
</html>
