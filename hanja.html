<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hanja Dictionary</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <h1>1,000 Hanja Characters</h1>
    <div id="hanja-sections"></div>

    <script>
        const SHEET_ID = '11u6-30QjGz08BPbj5mC_abQr64lpzHuH59AoWgP3VLU';
        const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

        fetch(URL)
            .then(response => response.text())
            .then(data => {
                const json = JSON.parse(data.substring(47, data.length - 2)); 
                const rows = json.table.rows.map(row => row.c.map(cell => cell ? cell.v : ''));

                displayData(rows);
            })
            .catch(error => console.error('Error loading data:', error));


        const sections = {
            1: { start: 1, end: 18 },
            2: { start: 19, end: 51 },
            3: { start: 52, end: 81 },
            4: { start: 82, end: 124 },
            5: { start: 125, end: 125 }
        };


        function displayData(data) {
            let currentSection = 1;


            data.forEach(row => {
                const [sectionHanja, sectionKorean, sectionMeaning] = row;
                if (sectionHanja && sectionKorean && sectionMeaning) {
                    const sectionDiv = document.createElement('section');
                    sectionDiv.id = `section-${currentSection}`;
                    sectionDiv.innerHTML = `<h2>${sectionHanja} - ${sectionKorean}</h2><p>${sectionMeaning}</p>`;
                    document.getElementById('hanja-sections').appendChild(sectionDiv);
                    currentSection++;
                }
            });

            Object.entries(sections).forEach(([section, range]) => {
                const sectionDiv = document.getElementById(`section-${section}`);
                if (!sectionDiv) return;

                const sectionPhrases = data.filter(row => {
                    const phraseNumber = Number(row[3]); 
                    return phraseNumber >= range.start && phraseNumber <= range.end;
                });

                sectionPhrases.forEach(row => {
                    const [
                        ,
                        ,
                        ,
                        phraseNumber,  
                        phraseHanja,   
                        phraseKorean,  
                        phraseMeaning 
                    ] = row;


                    const phraseDiv = document.createElement('div');
                    phraseDiv.classList.add('phrase');
                    phraseDiv.innerHTML = `
                        <div class="phrase-header">${phraseNumber}. ${phraseHanja} (${phraseKorean})</div>
                    `;
       
                    createCharacterSet(phraseDiv, data, phraseNumber, 0, 4);

                    createCharacterSet(phraseDiv, data, phraseNumber, 4, 8);

                    sectionDiv.appendChild(phraseDiv);
                });
            });
        }

        function createCharacterSet(container, data, phraseNumber, start, end) {
            // Character Boxes
            const characterBoxes = document.createElement('div');
            characterBoxes.classList.add('character-boxes');
            addCharacterBoxes(characterBoxes, data, phraseNumber, start, end);
            container.appendChild(characterBoxes);

            // Phrase Meaning (Column G: phrase_meaning)
            const meaningDiv = document.createElement('div');
            meaningDiv.classList.add('phrase-meaning');
            const meaningRow = data.find(r => Number(r[3]) === phraseNumber && r[6]);
            meaningDiv.textContent = meaningRow ? meaningRow[6] : '';
            container.appendChild(meaningDiv);
        }

        function addCharacterBoxes(container, data, phraseNumber, start, end) {
            for (let i = start; i < end; i++) {
                const characterRow = data.find(r => Number(r[3]) === phraseNumber && r[7 + i - start]); 
                if (characterRow) {
                    const characterBox = document.createElement('div');
                    characterBox.classList.add('character-box');
                    characterBox.innerHTML = `
                        <div class="hanja">${characterRow[7]}</div>   <!-- Column H: character_hanja -->
                        <div class="korean">${characterRow[8]}</div>  <!-- Column I: character_korean -->
                        <div class="sound">${characterRow[9]}</div>   <!-- Column J: character_sound -->
                    `;
                    container.appendChild(characterBox);
                }
            }
        }
    </script>
</body>
</html>
